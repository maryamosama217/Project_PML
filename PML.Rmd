---
title: "PML"
author: "maryam"
date: "11/6/2020"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Practical ML project
load requiered packages:
```{r}
library(caret)
library(lubridate)
library(e1071)
```

first of all we download the data files:
```{r}
download.file("https://d396qusza40orc.cloudfront.net/predmachlearn/pml-training.csv",
              destfile ="C:/Users/DELL/Desktop/Project_PML/pml-training.csv" )
download.file("https://d396qusza40orc.cloudfront.net/predmachlearn/pml-testing.csv",
              destfile ="C:/Users/DELL/Desktop/Project_PML/pml-testing.csv" )

```
second we read the data files as CSV:
```{r}
training<-read.csv("C:/Users/DELL/Desktop/Project_PML/pml-training.csv")
testing<-read.csv("C:/Users/DELL/Desktop/Project_PML/pml-testing.csv")
```
recognizing the data
```{r}
summary(training)
```
some of the variables are wrongly identefied as characters
```{r}
training$cvtd_timestamp=as.Date(training$cvtd_timestamp,format =c("%d/%m/%y"))

for(i in colnames(training[,-c(1,2,5,6,160)])){training[,i]=as.numeric(training[,i])}

```

to look for missing values:
```{r}
table(sapply(training,function(x){sum(is.na(x))}))
```

note that some of the variables are measured once for a group pf observations and it returnes NA
for any other observation.
we need to split these two groups of variable and analyze them separately:
```{r}
groupvar1<-training[,sapply(training[,-c(1,2)],Negate(anyNA)),drop=F]
groupvar1$classe=as.factor(groupvar1$classe);groupvar1$new_window=as.factor(groupvar1$new_window)
groupvar2<-training[,-as.list(colnames(groupvar1))] #==============> problem 

```

split training data into training,validation and testing:
```{r}
intrain<-createDataPartition(y=groupvar1$classe,p=0.6,list = F)
train<-groupvar1[intrain,]
vt<-groupvar1[-intrain,]
invalidate<-createDataPartition(y=vt$classe,list=F)
validate<-vt[invalidate,]
test<-vt[-invalidate,]
```
look at the correlation matrix:
```{r}
M<-cor(groupvar1[,-c(5,6,60)])
which(M>0.8&M!=1|M<(-0.8),arr.ind = T)
```
as we can see, many variables had correlation with each other so, we tend to use PCA:
```{r}
prepro<-preProcess(train[,-c(5,6,60)],method = "pca",thresh = 0.95)#====>27 PC needed
```
we will start building our model by trying several ML algorithms:
```{r}
modelFit1<-train(classe~.,data=train[,-5],method="rpart",na.action=na.exclude)
```

```{r}
modelfit2<-train(classe~.,data=train[,-5],method="rf",preProcess="rf",na.action=na.exclude)
```



## Including Plots

You can also embed plots, for example:

```{r pressure, echo=FALSE}
plot(pressure)
```

Note that the `echo = FALSE` parameter was added to the code chunk to prevent printing of the R code that generated the plot.

When you click the **Knit** button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document. You can embed an R code chunk like this: